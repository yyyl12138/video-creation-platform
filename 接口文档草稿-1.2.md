## 0. 接口设计规范 (Global Specifications)

### 0.1 命名与字段映射
本接口文档遵循 **前后端分离** 命名规范。
- **接口传输层（DTO/VO）**: 统一使用 `camelCase`（小驼峰命名）。
- **数据库持久层（DB）**: 使用 `snake_case`（下划线命名）。
- **开发要求**: 开发时需配置 ORM（如 MyBatis）的自动映射。(示例: DB中的 `user_id` -> 接口中的 `userId`)

### 0.2 错误码体系
废弃单一的 `code: 200/500`，改用业务域错误码：
| 错误码区间 | 说明 | 示例 |
| :--- | :--- | :--- |
| `20000` | 成功 (Success) | - |
| `100xx` | 用户与权限模块错误 | 10001-用户未登录 |
| `200xx` | 素材与资源错误 | 20001-文件格式不支持 |
| `300xx` | 创作与任务错误 | 30001-余额不足, 30002-模版不存在 |
| `400xx` | 审核与安全错误 | 40001-包含敏感词 |
| `500xx` | 系统与配置错误 | 50001-服务繁忙 |
| `99999` | 未知系统异常 | - |

### 0.3 通用响应结构
所有接口均返回此标准结构：
```JSON
{
  "code": 20000,        // 业务状态码
  "message": "success", // 提示信息
  "data": { ... },      // 泛型数据
  "timestamp": 1704067200000
}
```
**通用失败响应示例**:

```json
{
  "code": 30001,
  "message": "账户余额不足，无法提交任务",
  "data": null,
  "timestamp": 1704067200000
}
```

### 0.4 分页与限流约束
- 所有分页接口（List），`size` 参数最大限制为 **100**。
- 若前端传递超过 100，后端将强制重置为 100 或返回参数错误。

------

### 模块一：用户管理与权限模块 (User Management & Authority)

设计说明：

本模块涵盖用户注册登录、个人信息管理、密码安全以及钱包资产查询。基于 RBAC 模型设计。
**核心角色说明**：
1. **普通用户 (General User)**：短视频创作者。使用AI工具创作视频，导出发布至外部平台(B站/抖音)。可申请成为模版创作者。
2. **模版创作者 (Template Creator)**：高阶用户。设计创作工作流（模版），发布到市场供他人使用并获益。
3. **管理员 (Admin)**：运营人员，负责审核与管理。

------

#### 1. 认证服务 (Auth Service)

##### 1.1 用户注册

- **接口路径**: `/api/v1/auth/register`
- **请求方式**: `POST`
- **描述**: 用户通过用户名、邮箱和密码进行注册，默认分配普通用户角色。
- **权限要求**: 匿名

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明** | **校验规则**                          |
| ---------- | -------- | -------- | -------- | ------------------------------------- |
| `username` | String   | 是       | 用户名   | `@NotBlank`, 长度4-20                 |
| `email`    | String   | 是       | 邮箱     | `@Email`, 唯一性校验                  |
| `password` | String   | 是       | 密码     | `@NotBlank`, 长度6-20                 |
| `phone`    | String   | 否       | 手机号   | `@Pattern(regexp = "^1[3-9]\\d{9}$")` |

**响应结构 (VO):**

```JSON
{
  "userId": "U20260113001",
  "username": "developer_wu",
  "registerTime": "2026-01-13 10:00:00"
}
```

##### 1.2 用户登录

- **接口路径**: `/api/v1/auth/login`
- **请求方式**: `POST`
- **描述**: 账号密码登录，返回 JWT Token。
- **权限要求**: 匿名

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明**    | **校验规则** |
| ---------- | -------- | -------- | ----------- | ------------ |
| `username` | String   | 是       | 用户名/邮箱 | `@NotBlank`  |
| `password` | String   | 是       | 密码        | `@NotBlank`  |

**响应结构 (VO):**



```JSON
{
  "token": "eyJhbGciOiJIUzI1Ni...", // JWT Token
  "refreshToken": "ref_...",        // 刷新Token (需妥善保管)
  "expireIn": 3600, // 过期时间(秒)
  "userInfo": {
    "userId": "U20260113001",
    "username": "developer_wu",
    "avatarUrl": "http://oss.../default.png",
    "roles": ["ROLE_USER"]
  }
}
```

##### 1.3 发送验证码 (注册/找回密码)

- **接口路径**: `/api/v1/auth/verification-code`
- **请求方式**: `POST`
- **描述**: 发送手机或邮箱验证码（开发阶段可直接返回验证码 Mock 数据）。
- **权限要求**: 匿名

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明**     | **校验规则**              |
| ---------- | -------- | -------- | ------------ | ------------------------- |
| `target`   | String   | 是       | 手机号或邮箱 | `@NotBlank`               |
| `type`     | String   | 是       | 场景类型     | 枚举: REGISTER, RESET_PWD |

**响应结构 (VO):** `Boolean` (发送成功为 true)

##### 1.4 重置密码 (忘记密码流程)

- **接口路径**: `/api/v1/auth/password/reset`
- **请求方式**: `POST`
- **描述**: 校验验证码并重置密码。
- **权限要求**: 匿名

**请求参数 (DTO):**

| **字段名**    | **类型** | **必填** | **说明**     | **校验规则**          |
| ------------- | -------- | -------- | ------------ | --------------------- |
| `target`      | String   | 是       | 手机号或邮箱 | `@NotBlank`           |
| `code`        | String   | 是       | 验证码       | 长度6位               |
| `newPassword` | String   | 是       | 新密码       | `@NotBlank`, 长度6-20 |

**响应结构 (VO):** `Boolean`

##### 1.5 用户登出

- **接口路径**: `/api/v1/auth/logout`
- **请求方式**: `POST`
- **描述**: 服务端注销 Token（如果是 Redis 存储 Session）或 前端丢弃 Token。
- **权限要求**: 登录用户

**响应结构 (VO):** `Boolean`

------

#### 2. 用户信息服务 (User Service)

##### 2.1 获取当前用户信息

- **接口路径**: `/api/v1/users/me`
- **请求方式**: `GET`
- **描述**: 获取当前登录用户的详细档案（聚合 `users` 和 `user_profiles` 表）。
- **权限要求**: 登录用户

**响应结构 (VO):**

```JSON
{
  "userId": "U20260113001",
  "username": "developer_wu",
  "email": "wu@example.com",
  "phone": "13800138000",
  "avatarUrl": "http://oss.../avatar.jpg",
  "profile": {
    "realName": "吴阳",
    "gender": "男", // 枚举值
    "birthday": "2000-01-01",
    "country": "中国",
    "city": "贵阳",
    "bio": "全栈开发者"
  },
  "vipStatus": "NORMAL",         // 会员状态: NORMAL, VIP, SVIP
  "vipExpireDate": null,         // 会员过期时间
  "creatorStatus": "NONE",       // 创作者身份: NONE, APPLIED, APPROVED, REJECTED
  "status": "正常"
}
```

##### 2.2 更新个人资料

- **接口路径**: `/api/v1/users/me/profile`
- **请求方式**: `PUT`
- **描述**: 更新用户的扩展信息。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明** | **校验规则**       |
| ---------- | -------- | -------- | -------- | ------------------ |
| `realName` | String   | 否       | 真实姓名 | 长度<50            |
| `gender`   | String   | 否       | 性别     | 枚举: 男, 女, 其他 |
| `birthday` | Date     | 否       | 生日     | 格式 yyyy-MM-dd    |
| `country`  | String   | 否       | 国家     | -                  |
| `city`     | String   | 否       | 城市     | -                  |
| `bio`      | String   | 否       | 简介     | 长度<500           |

**响应结构 (VO):** `Boolean` (true 表示更新成功)

##### 2.3 修改密码

- **接口路径**: `/api/v1/users/me/password`
- **请求方式**: `PUT`
- **描述**: 修改当前登录用户的密码。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名**    | **类型** | **必填** | **说明** | **校验规则**          |
| ------------- | -------- | -------- | -------- | --------------------- |
| `oldPassword` | String   | 是       | 旧密码   | `@NotBlank`           |
| `newPassword` | String   | 是       | 新密码   | `@NotBlank`, 长度6-20 |

**响应结构 (VO):** `Boolean` (true 表示修改成功)

##### 2.4 申请成为模版创作者

- **接口路径**: `/api/v1/users/me/apply-creator`
- **请求方式**: `POST`
- **描述**: 普通用户提交申请，成为模版创作者。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名**     | **类型** | **必填** | **说明** | **校验规则** |
| -------------- | -------- | -------- | -------- | ------------ |
| `introduction` | String   | 是       | 创作简介 | 长度<500     |
| `portfolioUrl` | String   | 否       | 作品集   | 外部链接     |

**响应结构 (VO):** `Boolean`

##### 2.5 开通/续费会员
- **接口路径**: `/api/v1/users/me/vip-subscription`
- **请求方式**: `POST`
- **描述**: 发起会员订阅，跳转支付。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明** |
| :--- | :--- | :--- | :--- |
| `planId` | Integer | 是 | 会员套餐ID (月卡/年卡) |
| `payChannel`| String | 是 | 支付方式 |

**响应结构 (VO):** 同 `1.1 创建支付订单`

##### 2.6 用户头像上传 (独立接口)

- **接口路径**: `/api/v1/users/me/avatar`
- **请求方式**: `POST`
- **Content-Type**: `multipart/form-data`
- **描述**: 用户上传头像图片。后端处理逻辑：1. 接收文件存入本地/OSS；2. 更新 `users` 表的 `avatar_url` 字段；3. 返回新的图片链接。
- **权限要求**: 登录用户

**请求参数 (FormData):**

| **字段名** | **类型** | **必填** | **说明** | **校验规则**           |
| ---------- | -------- | -------- | -------- | ---------------------- |
| `file`     | File     | 是       | 图片文件 | 最大 2MB, 格式 jpg/png |

**响应结构 (VO):**

```JSON
{
  "avatarUrl": "http://oss.huike.com/uploads/avatar/u1001_20260113.jpg",
  "fileSize": 1048576
}
```

##### 2.7 注销账户
- **接口路径**: `/api/v1/users/me`
- **请求方式**: `DELETE`
- **描述**: 永久注销当前用户账号。
  - **前置条件**: 
    1. 账号无未完成的订单或任务。
    2. 钱包余额已结清（或用户同意放弃）。
  - **处理逻辑**: 软删除 (`deleted=1`)，保留法定要求期限内的交易日志，但清除敏感数据。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明** | **校验规则** |
| :--- | :--- | :--- | :--- | :--- |
| `password` | String | 是 | 确认密码 | 需二次验证 |
| `reason` | String | 否 | 注销原因 | 收集反馈 |

**响应结构 (VO):** `Boolean`

------

#### 3. 钱包资产服务 (Wallet Service)

##### 3.1 获取钱包余额

- **接口路径**: `/api/v1/wallets/me`
- **请求方式**: `GET`
- **描述**: 获取当前用户的积分/Token余额及累计消费信息。
- **权限要求**: 登录用户

**响应结构 (VO):**

```JSON
{
  "walletId": 1001,
  "balance": 500.00,       // 当前剩余积分
  "totalRecharged": 1000.00, // 累计充值
  "totalConsumed": 500.00,   // 累计消费
  "updatedTime": "2026-01-13 12:00:00"
}
```

##### 3.2 获取交易流水

- **接口路径**: `/api/v1/wallets/me/transactions`
- **请求方式**: `GET`
- **描述**: 分页查询钱包的收支明细。
- **权限要求**: 登录用户

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明**                   | **默认值** |
| ---------- | -------- | -------- | -------------------------- | ---------- |
| `page`     | Integer  | 否       | 页码                       | 1          |
| `size`     | Integer  | 否       | 每页条数                   | 10         |
| `type`     | String   | 否       | 交易类型(RECHARGE/CONSUME) | null       |

**响应结构 (VO):**

```JSON
{
  "total": 100,
  "records": [
    {
      "transactionId": 5001,
      "type": "CONSUME", // 消费
      "amount": -10.00,
      "description": "生成视频任务: T20260113005",
      "relatedTaskId": "T20260113005",
      "createdTime": "2026-01-13 14:30:00"
    }
  ]
}
```



##### 3.3 发起充值
- **接口路径**: `/api/v1/wallets/me/recharge`
- **请求方式**: `POST`
- **描述**: 快捷充值入口，本质是调用 `/api/v1/orders` 创建 RECHARGE 类型订单的封装。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明** |
| :--- | :--- | :--- | :--- |
| `packageId` | Integer | 是 | 充值套餐ID |
| `payChannel`| String | 是 | ALIPAY/WECHAT |

**响应结构 (VO):** 同 `1.1 创建支付订单`

##### 3.4 发起提现 (创作者)
- **接口路径**: `/api/v1/wallets/me/withdraw`
- **请求方式**: `POST`
- **描述**: 创作者申请提现收益。
- **权限要求**: 登录用户 (creatorStatus=APPROVED)

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明** |
| :--- | :--- | :--- | :--- |
| `amount` | BigDecimal | 是 | 提现金额 |
| `accountInfo`| JSON | 是 | 收款账号信息 |

**响应结构 (VO):** `Boolean`

------

#### 4. 管理员用户管理 (Admin User Management)

##### 4.1 获取用户列表 (管理员)

- **接口路径**: `/api/v1/admin/users`
- **请求方式**: `GET`
- **描述**: 管理员分页查询用户列表，支持按用户名或状态筛选。
- **权限要求**: 管理员

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明**            | **默认值** |
| ---------- | -------- | -------- | ------------------- | ---------- |
| `page`     | Integer  | 否       | 页码                | 1          |
| `size`     | Integer  | 否       | 每页条数            | 20         |
| `keyword`  | String   | 否       | 搜索用户名/手机号   | null       |
| `status`   | String   | 否       | 状态筛选(正常/封禁) | null       |

**响应结构 (VO):**

```JSON
{
  "total": 50,
  "records": [
    {
      "userId": "U1001",
      "username": "zhangsan",
      "email": "zs@qq.com",
      "roleName": "普通用户",
      "videoCount": 15,    // 生成视频数量 (关联统计)
      "status": "正常",
      "registerTime": "2026-01-01 10:00:00"
    }
  ]
}
```

##### 4.2 封禁/解封用户

- **接口路径**: `/api/v1/admin/users/{userId}/status`
- **请求方式**: `PUT`
- **描述**: 修改用户状态（对应触发器 `trig_user_status_after_update` ）。
- **权限要求**: 管理员

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明** | **校验规则**           |
| ---------- | -------- | -------- | -------- | ---------------------- |
| `status`   | String   | 是       | 目标状态 | 枚举: 正常, 封禁, 禁用 |
| `reason`   | String   | 否       | 操作原因 | 记录日志用             |

**响应结构 (VO):** `Boolean`

##### 4.3 获取用户详情 (管理员视图)

- **接口路径**: `/api/v1/admin/users/{userId}`
- **请求方式**: `GET`
- **描述**: 获取特定用户的详细信息，包含最近登录IP、最后登录时间等（对应 `users` 表 ）。
- **权限要求**: 管理员

**响应结构 (VO):**

```JSON
{
  "userId": "U1001",
  "username": "zhangsan",
  "lastLoginTime": "2026-01-12 09:00:00",
  "lastLoginIp": "192.168.1.1", // 来自 user_activity_logs 表或 users 扩展
  "walletBalance": 100.00
}
```

------





------

# 模块二：素材资源管理模块

## 1. 管理员素材管理 (Admin Material Management)

### 1.1 系统素材上传 (管理员)

- **接口路径**: `/api/v1/admin/materials`
- **请求方式**: `POST`
- **Content-Type**: `multipart/form-data`
- **描述**: 管理员上传官方素材（背景图、BGM、贴纸等），`source_type` 默认为 `SYSTEM`，`is_public` 默认为 `true`。
- **权限要求**: 管理员

**请求参数 (FormData):**

| **字段名**        | **类型** | **必填** | **说明** | **校验规则**                                        |
| ----------------- | -------- | -------- | -------- | --------------------------------------------------- |
| `file`            | File     | 是       | 文件     | -                                                   |
| `type`            | String   | 是       | 素材类型 | IMAGE/VIDEO/AUDIO                                   |
| `copyrightStatus` | String   | 是       | 版权状态 | 枚举: FREE_COMMERCIAL (免费商用), PAID (付费授权) 1 |
| `category`        | String   | 否       | 分类     | 如 "风景", "科技"                                   |
| `tags`            | String   | 否       | 标签     | 逗号分隔                                            |

**响应结构 (VO):**

```JSON
{
  "materialId": "SYS_IMG_001",
  "url": "http://oss.../sys.jpg",
  "copyrightStatus": "FREE_COMMERCIAL"
}
```

### 1.2 素材状态/审核管理

- **接口路径**: `/api/v1/admin/materials/{materialId}/status`

- **请求方式**: `PUT`

- **描述**: 管理员对违规素材进行封禁，或对用户上传的素材进行审核标记。对应数据库中的 `status` 字段 
- **权限要求**: 管理员

  

  

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明** | **校验规则**                                           |
| ---------- | -------- | -------- | -------- | :----------------------------------------------------- |
| `type`     | String   | 是       | 素材类型 | IMAGE/VIDEO/AUDIO (定位表)                             |
| `status`   | String   | 是       | 目标状态 | 枚举: NORMAL (正常), BANNED (封禁), REVIEWING (审核中) |
| `reason`   | String   | 否       | 操作原因 | 封禁时必填                                             |

**响应结构 (VO):** `Boolean`

### 1.3 标记素材版权

- **接口路径**: `/api/v1/admin/materials/{materialId}/copyright`
- **请求方式**: `PUT`
- **描述**: 管理员更新素材的版权属性（如将某首BGM标记为付费）。
- **权限要求**: 管理员

**请求参数 (DTO):**

| **字段名**        | **类型** | **必填** | **说明** | **校验规则**                        |
| ----------------- | -------- | -------- | -------- | ----------------------------------- |
| `type`            | String   | 是       | 素材类型 | IMAGE/VIDEO/AUDIO                   |
| `copyrightStatus` | String   | 是       | 版权状态 | FREE_COMMERCIAL, PAID, PERSONAL_USE |

**响应结构 (VO):** `Boolean`

------

## 2. 标签与分类服务 (Tag & Category Service)

### 2.1 获取热门标签/分类

- **接口路径**: `/api/v1/materials/tags/hot`
- **请求方式**: `GET`
- **描述**: 获取系统推荐的热门标签或分类树，用于前端上传时的“标签选择器”或搜索时的“快捷筛选”。
- **权限要求**: 登录用户

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明** |
| ---------- | -------- | -------- | -------- |
| `type`     | String   | 否       | 素材类型 |

**响应结构 (VO):**

```JSON
{
  "categories": ["风景", "人物", "科技", "情感"],
  "hotTags": [
    { "name": "治愈", "count": 1024 },
    { "name": "卡点", "count": 850 }
  ]
}
```

### 2.2 AI 自动识别标签 (辅助接口)

- **接口路径**: `/api/v1/materials/tags/ai-predict`
- **请求方式**: `POST`
- **描述**: 上传素材后，调用此接口获取 AI 识别的标签建议（前端预填用）。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名**    | **类型** | **必填** | **说明**    |
| ------------- | -------- | -------- | ----------- |
| `materialUrl` | String   | 是       | 素材地址    |
| `type`        | String   | 是       | IMAGE/VIDEO |

**响应结构 (VO):**

```JSON
{
  "suggestedTags": ["蓝天", "户外", "微笑"]
}
```

------

## 3. 用户素材服务 (User Material Service)

### 3.1 获取素材详情

- **接口路径**: `/api/v1/materials/{materialId}`
- **请求方式**: `GET`
- **描述**: 获取单个素材的完整元数据（包括分辨率、大小、创建时间、标签等）。
- **权限要求**: 登录用户

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明**          |
| ---------- | -------- | -------- | ----------------- |
| `type`     | String   | 是       | IMAGE/VIDEO/AUDIO |

**响应结构 (VO):**

```JSON
{
  "materialId": "VID_001",
  "name": "旅行.mp4",
  "url": "http://oss...",
  "resolution": "1920x1080",
  "durationSeconds": 15.5,
  "fileSize": 10485760,
  "tags": ["Vlog", "旅行"],
  "sourceType": "USER_UPLOAD",
  "copyrightStatus": "PERSONAL_USE",
  "createTime": "2026-01-13 10:00:00"
}
```

### 3.2 获取素材列表

- **接口路径**: `/api/v1/materials`
- **请求方式**: `GET`
- **描述**: 查询素材列表。
- **权限要求**: 登录用户

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明**                                                     |
| ---------- | -------- | -------- | ------------------------------------------------------------ |
| `page`     | Integer  | 否       | 页码                                                         |
| `size`     | Integer  | 否       | 每页条数                                                     |
| `isSystem` | Boolean  | 否       | 是否系统素材 (true: 官方素材库, false: 个人素材库, null: 全部) |
| `type`     | String   | 否       | IMAGE/VIDEO/AUDIO                                            |

**响应结构 (VO):** `PageResult<MaterialVO>`

### 3.3 批量删除素材

- **接口路径**: `/api/v1/materials/batch`
- **请求方式**: `DELETE`
- **描述**: 用户批量清理素材库。**注意**：如果是官方素材(`isSystem=true`)，仅管理员可删；如果是个人素材，仅本人可删。
- **权限要求**: 登录用户

**请求参数 (DTO - Delete Body):**

| **字段名**    | **类型**     | **必填** | **说明**                            |
| ------------- | ------------ | -------- | ----------------------------------- |
| `materialIds` | List<String> | 是       | ID列表                              |
| `type`        | String       | 是       | 素材类型 (目前限制批量删除需同类型) |

**响应结构 (VO):**



```JSON
{
  "successCount": 5,
  "failCount": 0
}
```







### 3.4 用户上传素材

- **接口路径**: `/api/v1/materials`
- **请求方式**: `POST`
- **Content-Type**: `multipart/form-data`
- **描述**: 用户上传个人素材（图片、视频、音频），用于后续的AI生成参考或剪辑。系统会自动识别文件元数据（大小、分辨率）。
- **权限要求**: 登录用户

**请求参数 (FormData):**

| **字段名** | **类型** | **必填** | **说明** | **校验规则**                               |
| ---------- | -------- | -------- | -------- | ------------------------------------------ |
| `file`     | File     | 是       | 文件数据 | 最大 500MB (视配置而定)                    |
| `type`     | String   | 否       | 素材类型 | IMAGE/VIDEO/AUDIO (若不传则根据后缀判断)   |
| `name`     | String   | 否       | 素材名称 | 若不传则使用文件名                         |
| `albumId`  | String   | 否       | 目标相册 | 暂留后续扩展                               |

**响应结构 (VO):**

```JSON
{
  "materialId": "MAT_U_20260114001",
  "url": "http://oss.../user_upload/abc.mp4",
  "type": "VIDEO",
  "fileSize": 52428800
}
```

------

# 模块三：创作与任务处理模块 (Creation & Task Processing)

设计说明：

覆盖热点获取、AI脚本辅助、视频生成任务提交与轮询、以及在线剪辑工程的存取。

**通用枚举定义:**

- `TaskType`: `TEXT_TO_SCRIPT` (写脚本), `TEXT_TO_IMAGE` (绘图), `IMAGE_TO_VIDEO` (图生视频), `TEXT_TO_VIDEO` (文生视频), `VIDEO_RENDER` (剪辑渲染)
- `TaskStatus`: `PENDING` (排队), `PROCESSING` (执行中), `SUCCESS` (成功), `FAILED` (失败), `CANCELLED` (取消)

------

## 1. AI 辅助创作服务 (AI Auxiliary Service)



### 1.1 获取全网热点

- **接口路径**: `/api/v1/creation/hotspots`
- **请求方式**: `GET`
- **描述**: 获取聚合的多平台（抖音/微博/知乎）实时热搜，辅助用户选题。
- **权限要求**: 登录用户

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明** | **默认值**                |
| ---------- | -------- | -------- | -------- | ------------------------- |
| `platform` | String   | 否       | 来源平台 | all (全部), douyin, weibo |
| `limit`    | Integer  | 否       | 数量限制 | 10                        |

**响应结构 (VO):**

```
{
  "list": [
    {
      "title": "2026年春节旅游攻略",
      "hotIndex": 980000,
      "platform": "douyin",
      "url": "https://..."
    }
  ]
}
```

### 1.2 AI 生成/优化脚本

- **接口路径**: `/api/v1/creation/scripts/generate`

- **请求方式**: `POST`

- **描述**: [多模式聚合接口] 调用 LLM 模型生成分镜脚本，或对用户输入的草稿进行润色（扩写/缩写/改风格）。`type` 参数决定业务逻辑。
- **权限要求**: 登录用户

  

  

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明**         | **校验规则**                              |
| ---------- | -------- | -------- | ---------------- | ----------------------------------------- |
| `type`     | String   | 是       | 操作类型         | CREATE(生成), REWRITE(改写), EXPAND(扩写) |
| `prompt`   | String   | 是       | 提示词或原始内容 | 长度<2000                                 |
| `style`    | String   | 否       | 风格             | 幽默/科普/悬疑/带货                       |
| `modelKey` | String   | 否       | 指定模型         | 默认使用系统配置的主力模型                |

**响应结构 (VO):**

```JSON
{
  "content": "【镜头1】画面：... 旁白：...", // 纯文本内容
  "structuredScript": [ // 结构化分镜(可选)
    { "scene": 1, "visual": "...", "audio": "..." }
  ]
}
```

### 1.3 AI 通用文本生成 (同步任务)

- **接口路径**: `/api/v1/creation/text/generate`
- **请求方式**: `POST`
- **描述**: 通用的文生文接口，适用于短文本生成（如标题、朋友圈文案、评论回复等）。此接口为同步返回，不走异步任务队列。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明**         | **校验规则** |
| ---------- | -------- | -------- | ---------------- | ------------ |
| `prompt`   | String   | 是       | 提示词           | 长度<5000    |
| `modelKey` | String   | 否       | 指定模型         |              |

**响应结构 (VO):**

```JSON
{
  "content": "生成的文本内容...",
  "costToken": 150
}
```

------

## 2. 核心生成任务服务 (Core Generation Service)





### 2.1 提交生成任务

- **接口路径**: `/api/v1/generation/tasks`
- **请求方式**: `POST`
- **描述**: 提交一个耗时任务（如文生视频、图生视频）。系统校验余额后，创建任务记录并返回 `taskId`。错误码引用: 30002 (模版不存在), 30001 (余额不足)。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名**    | **类型** | **必填** | **说明**     | **校验规则**                                                 |
| ------------- | -------- | -------- | ------------ | ------------------------------------------------------------ |
| `taskType`    | String   | 是       | 任务类型     | TEXT_TO_IMAGE / TEXT_TO_VIDEO / IMAGE_TO_VIDEO |
| `modelKey`    | String   | 是       | 模型标识     | 必须存在于 ai_models 表                                      |
| `templateId`  | String   | 否       | 使用的模板ID | -                                                            |
| `inputConfig` | JSON     | 是       | **核心参数** | 包含 prompt, initImageUrl, ratio(比例,如16:9), duration(时长,秒) 等 |
| `priority`    | Integer  | 否       | 优先级       | 默认5，会员可传高值                                          |

**响应结构 (VO):**

```JSON
{
  "taskId": "T20260113005",
  "status": "PENDING",
  "queuePosition": 12, // 当前排队人数
  "estimatedTime": 60  // 预估耗时(秒)
}
```

### 2.2 查询任务详情/状态

- **接口路径**: `/api/v1/generation/tasks/{taskId}`
- **请求方式**: `GET`
- **描述**: 前端轮询此接口获取进度。成功后返回结果地址（下载链接）。
- **权限要求**: 登录用户

**响应结构 (VO):**

```JSON
{
  "taskId": "T20260113005",
  "status": "PROCESSING", // PENDING, PROCESSING, SUCCESS, FAILED
  "progress": 45,         // 0-100
  "result": {             // 成功时有值
    "videoUrl": "http://oss.../res.mp4",
    "coverUrl": "http://oss.../cover.jpg",
    "duration": 5.5,
    "size": 10485760
  },
  "error": null
}
```

### 2.3 获取历史任务列表

- **接口路径**: `/api/v1/generation/tasks`
- **请求方式**: `GET`
- **描述**: 查询用户的生成历史，支持状态筛选。
- **权限要求**: 登录用户

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明**       |
| ---------- | -------- | -------- | -------------- |
| `page`     | Integer  | 否       | 1              |
| `status`   | String   | 否       | SUCCESS/FAILED |
| `taskType` | String   | 否       | 筛选类型       |

**响应结构 (VO):** `PageResult<TaskDetailVO>`

### 2.4 取消任务

- **接口路径**: `/api/v1/generation/tasks/{taskId}/cancel`
- **请求方式**: `POST`
- **描述**: 仅 `PENDING` 或 `PROCESSING` 状态的任务可取消。取消后不退还部分积分（视策略而定）。
- **权限要求**: 登录用户

**响应结构 (VO):** `Boolean`

------

## 3. 模版管理服务 (Template Management Service)

*面向模版创作者，用于构建和发布复用性工作流。*

### 3.1 创建/更新模版草稿

- **接口路径**: `/api/v1/templates`
- **请求方式**: `POST`
- **描述**: 保存模版配置。如果 `templateId` 为空则创建。
- **权限要求**: 登录用户 (且 creatorStatus=APPROVED)

**请求参数 (DTO):**

| **字段名**       | **类型** | **必填** | **说明**         | **校验规则**                  |
| ---------------- | -------- | -------- | ---------------- | ----------------------------- |
| `templateId`     | String   | 否       | 模版ID           | 更新时必填                    |
| `name`           | String   | 是       | 模版名称         | -                             |
| `description`    | String   | 否       | 描述             | -                             |
| `workflowConfig` | JSON     | 是       | **核心工作流**   | 包含节点编排、参数预设        |
| `demoVideoUrl`   | String   | 否       | 演示视频         | -                             |
| `price`          | Decimal  | 否       | 价格             | 0为免费                       |
| `isPublic`       | Boolean  | 否       | 是否公开(上架)   | 默认 false                    |

**响应结构 (VO):** `{ "templateId": "TMP_202601..." }`

### 3.2 我的模版列表

- **接口路径**: `/api/v1/templates/me`
- **请求方式**: `GET`
- **描述**: 获取当前创作者管理的模版列表。
- **权限要求**: 登录用户

**响应结构 (VO):** `PageResult<TemplateVO>`

------

## 4. 剪辑工程服务 (Editing Project Service)



对应《数据库设计》中的 `video_edit_projects` 表  及《三级清单》中的“剪辑工程”



### 4.1 保存剪辑草稿

- **接口路径**: `/api/v1/projects`
- **请求方式**: `POST`
- **描述**: 保存当前编辑器的时间轴状态。如果 `projectId` 为空则新建，否则更新。**支持自动保存逻辑**：即使是未完成的草稿，也能通过更新 `updated_time` 实现状态暂存。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名**     | **类型** | **必填** | **说明**           | **校验规则**                                  |
| -------------- | -------- | -------- | ------------------ | --------------------------------------------- |
| `projectId`    | String   | 否       | 工程ID             | 更新时必填                                    |
| `projectName`  | String   | 是       | 工程名称           | -                                             |
| `timelineData` | JSON     | 是       | **时间轴核心数据** | 包含 tracks(轨道), clips(片段), effects(特效) |
| `coverImage`   | String   | 否       | 封面图URL          | -                                             |

**响应结构 (VO):**

```JSON
{
  "projectId": "PRJ20260113001",
  "updatedTime": "2026-01-13 14:00:00"
}
```

### 4.2 获取剪辑工程详情

- **接口路径**: `/api/v1/projects/{projectId}`
- **请求方式**: `GET`
- **描述**: 加载工程数据，用于恢复编辑现场。
- **权限要求**: 登录用户

**响应结构 (VO):**

```JSON
{
  "projectId": "PRJ20260113001",
  "projectName": "未命名工程",
  "timelineData": { ... }, // 完整JSON
  "status": "DRAFT"
}
```

### 4.3 提交工程渲染

- **接口路径**: `/api/v1/projects/{projectId}/render`
- **请求方式**: `POST`
- **描述**: 将剪辑工程提交合成。后端会创建一个 `VIDEO_RENDER` 类型的任务，并将 `timelineData` 作为输入配置。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名**   | **类型** | **必填** | **说明**   |
| ------------ | -------- | -------- | ---------- |
| `resolution` | String   | 否       | 导出分辨率 |
| `fps`        | Integer  | 否       | 帧率       |

**响应结构 (VO):**

```JSON
{
  "taskId": "T_RENDER_009" // 关联到 generation/tasks 表
}
```

### 4.4 删除剪辑草稿
- **接口路径**: `/api/v1/projects/{projectId}`
- **请求方式**: `DELETE`
- **描述**: 删除未完成的剪辑工程草稿。
- **权限要求**: 登录用户 (仅限本人)

**响应结构 (VO):** `Boolean`







# 模块四：内容审核与安全模块 (Content Review & Security)

设计说明：

提供审核任务的查询与处理接口，支持“机器预审+人工复审”流程。同时提供审核规则（如敏感词库、自动拦截策略）的配置管理。

**通用枚举定义:**

- `ReviewStatus`: `PENDING` (待审核), `PASSED` (审核通过), `REJECTED` (驳回/违规), `RE_AUDIT` (复审中)
- `RuleType`: `TEXT_SENSITIVE` (文字敏感), `IMAGE_PORN` (图片鉴黄), `COPYRIGHT` (版权检测)

------

## 1. 审核任务管理 (Review Task Management)



### 1.1 获取审核列表 (管理员)

- **接口路径**: `/api/v1/admin/reviews`
- **请求方式**: `GET`
- **描述**: 管理员分页拉取待审核或历史审核记录。支持按状态筛选。
- **权限要求**: 管理员

**请求参数 (Query):**

| **字段名**    | **类型** | **必填** | **说明**                | **默认值**     |
| ------------- | -------- | -------- | ----------------------- | -------------- |
| `page`        | Integer  | 否       | 页码                    | 1              |
| `size`        | Integer  | 否       | 每页条数                | 20             |
| `status`      | String   | 否       | 状态筛选                | PENDING (默认) |
| `reviewerId`  | String   | 否       | 审核员ID (看自己的任务) | -              |
| `contentType` | String   | 否       | 内容类型 (VIDEO/IMAGE)  | -              |

**响应结构 (VO):**

```JSON
{
  "total": 50,
  "records": [
    {
      "reviewId": 1001,
      "contentId": "UGC20260113009",
      "contentUrl": "http://oss.../video.mp4",
      "coverUrl": "http://oss.../cover.jpg",
      "creatorName": "user_01",
      "submitTime": "2026-01-13 14:00:00",
      "machineCheckResult": "RISK_HIGH", // 机审建议(扩展字段)
      "status": "PENDING"
    }
  ]
}
```

### 1.2 获取审核详情

- **接口路径**: `/api/v1/admin/reviews/{reviewId}`
- **请求方式**: `GET`
- **描述**: 进入审核详情页，展示视频播放器、机审命中关键词高亮、历史驳回记录等。
- **权限要求**: 管理员

**响应结构 (VO):**

```JSON
{
  "reviewId": 1001,
  "content": {
    "url": "http://oss.../video.mp4",
    "title": "测试视频",
    "description": "这是描述..."
  },
  "history": [
    {
      "reviewTime": "2026-01-12 10:00:00",
      "reviewerName": "admin_01",
      "action": "REJECTED",
      "reason": "包含暴力画面"
    }
  ]
}
```

### 1.3 提交审核决定

- **接口路径**: `/api/v1/admin/reviews/{reviewId}/decision`
- **请求方式**: `PUT`
- **描述**: 管理员提交“通过”或“驳回”决定。此操作会更新 `content_reviews` 表，并联动更新 `user_generated_content` 的可见性。
- **权限要求**: 管理员

**请求参数 (DTO):**

| **字段名**     | **类型** | **必填** | **说明** | **校验规则**              |
| -------------- | -------- | -------- | -------- | ------------------------- |
| `status`       | String   | 是       | 决定结果 | PASSED, REJECTED          |
| `rejectReason` | String   | 否       | 驳回原因 | 当 status=REJECTED 时必填 |
| `suggestions`  | String   | 否       | 修改建议 | 选填                      |

**响应结构 (VO):** `Boolean`

------

## 2. 审核规则配置 (Review Rules Config)



### 2.1 获取规则列表

- **接口路径**: `/api/v1/admin/review-rules`
- **请求方式**: `GET`
- **描述**: 查看当前的自动审核规则（如：敏感词库版本、鉴黄阈值配置）。
- **权限要求**: 管理员

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明** |
| ---------- | -------- | -------- | -------- |
| `ruleType` | String   | 否       | 规则类型 |

**响应结构 (VO):**

```JSON
{
  "list": [
    {
      "ruleId": 1,
      "ruleName": "政治敏感词过滤-v1",
      "ruleType": "TEXT_SENSITIVE",
      "priority": 10,
      "status": "ENABLE",
      "conditions": { "keywords": ["词A", "词B"] } // JSON结构
    }
  ]
}
```

### 2.2 新增/修改规则

- **接口路径**: `/api/v1/admin/review-rules`
- **请求方式**: `POST`
- **描述**: 配置自动审核策略。例如设置“视频画面中出现刀具自动驳回”。
- **权限要求**: 管理员

**请求参数 (DTO):**

| **字段名**   | **类型** | **必填** | **说明** | **校验规则**              |
| ------------ | -------- | -------- | -------- | ------------------------- |
| `ruleId`     | Integer  | 否       | ID       | 更新时必填                |
| `ruleName`   | String   | 是       | 规则名称 | -                         |
| `ruleType`   | String   | 是       | 类型     | TEXT/IMAGE/VIDEO          |
| `conditions` | JSON     | 是       | 触发条件 | 如 `{"threshold": 80}`    |
| `actions`    | JSON     | 是       | 执行动作 | 如 `{"action": "REJECT"}` |
| `priority`   | Integer  | 否       | 优先级   | 默认5                     |

**响应结构 (VO):** `Integer` (返回 ruleId)

### 2.3 启用/禁用规则

- **接口路径**: `/api/v1/admin/review-rules/{ruleId}/status`
- **请求方式**: `PUT`
- **描述**: 快速开关某条规则。
- **权限要求**: 管理员

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明**         |
| ---------- | -------- | -------- | ---------------- |
| `status`   | String   | 是       | ENABLE / DISABLE |

**响应结构 (VO):** `Boolean`

------

## 3. 违规举报服务 (Report Service)



### 3.1 提交举报 (用户端)

- **接口路径**: `/api/v1/reports`
- **请求方式**: `POST`
- **描述**: 终端用户举报违规视频。举报信息将生成一条待审核记录（或流入专门的举报处理队列）。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名**    | **类型** | **必填** | **说明**     | **校验规则**        |
| ------------- | -------- | -------- | ------------ | ------------------- |
| `targetId`    | String   | 是       | 被举报内容ID | -                   |
| `targetType`  | String   | 是       | 类型         | VIDEO/COMMENT       |
| `reasonType`  | String   | 是       | 举报类型     | 涉黄/暴力/侵权/其他 |
| `description` | String   | 否       | 详细描述     | -                   |

**响应结构 (VO):** `Boolean`







------

# 模块五：系统配置与模型管理模块 (System Config & Model Management)

设计说明：

覆盖 AI 模型接入（API Key 管理）、TTS 语音配置、以及系统运行参数（存储路径、并发限制）的配置。

------

## 1. AI 模型接入管理 (AI Model Management)

### 1.1 获取模型列表 (管理员)

- **接口路径**: `/api/v1/admin/models`
- **请求方式**: `GET`
- **描述**: 获取后台配置的所有模型信息。**注意：**出于安全，返回的 `apiConfig` (如 Key) 应进行脱敏处理（如显示 `sk-***`）。
- **权限要求**: 超级管理员

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明**                    |
| ---------- | -------- | -------- | --------------------------- |
| `type`     | String   | 否       | 模型类型 (TEXT/IMAGE/VIDEO) |
| `provider` | String   | 否       | 提供商 (OpenAI/Local)       |

**响应结构 (VO):**

```JSON
{
  "list": [
    {
      "modelId": 1,
      "modelName": "GPT-4 Turbo",
      "modelKey": "gpt-4",
      "provider": "OpenAI",
      "modelType": "TEXT",
      "billingMode": "PER_TOKEN",
      "unitPrice": 0.002,
      "isActive": true,
      "apiEndpoint": "https://api.openai.com/v1"
    }
  ]
}
```

### 1.2 获取单个模型配置

- **接口路径**: `/api/v1/admin/ai-models/{modelId}`
- **请求方式**: `GET`
- **描述**: 获取单个模型的详细配置。Key需脱敏。
- **权限要求**: 超级管理员

**响应结构 (VO):** 同上 `list` 中的单项结构。

### 1.3 新增/修改模型配置

- **接口路径**: `/api/v1/admin/models`
- **请求方式**: `POST`
- **描述**: 接入新的模型或更新现有配置。更新时如果 `modelId` 存在则为修改。
- **权限要求**: 超级管理员

**请求参数 (DTO):**

| **字段名**    | **类型**   | **必填** | **说明**     | **校验规则**                            |
| ------------- | ---------- | -------- | ------------ | --------------------------------------- |
| `modelId`     | Integer    | 否       | ID           | 更新时必填                              |
| `modelName`   | String     | 是       | 显示名称     | -                                       |
| `modelKey`    | String     | 是       | 调用标识     | 唯一, 如 `runway-gen2`                  |
| `provider`    | String     | 是       | 提供商       | -                                       |
| `modelType`   | String     | 是       | 类型         | TEXT/IMAGE/VIDEO/AUDIO                  |
| `apiEndpoint` | String     | 是       | 接口地址     | URL格式                                 |
| `apiConfig`   | JSON       | 是       | **核心鉴权** | `{"apiKey": "sk-...", "secret": "..."}` |
| `unitPrice`   | BigDecimal | 是       | 单价         | -                                       |
| `isActive`    | Boolean    | 否       | 是否启用     | 默认 true                               |

**响应结构 (VO):** `Integer` (返回 modelId)

### 1.3 启用/停用模型

- **接口路径**: `/api/v1/admin/models/{modelId}/status`
- **请求方式**: `PUT`
- **描述**: 快速上下架某个模型（例如余额耗尽或服务宕机时紧急停用）。
- **权限要求**: 超级管理员

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明**   |
| ---------- | -------- | -------- | ---------- |
| `isActive` | Boolean  | 是       | true/false |

**响应结构 (VO):** `Boolean`

------

## 2. TTS 语音配置服务 (TTS Config Service)

*对应《三级清单》中的“TTS配置”与“男声/女声/音色选择” *

### 2.1 获取 TTS 语音列表

- **接口路径**: `/api/v1/admin/tts-configs`
- **请求方式**: `GET`
- **描述**: 管理员查看当前系统支持的音色库。
- **权限要求**: 超级管理员

**响应结构 (VO):**

```JSON
{
  "list": [
    {
      "ttsId": 101,
      "modelName": "Edge-TTS-Xiaoxiao",
      "voiceType": "女声",
      "languageType": "zh-CN",
      "status": "ENABLE"
    }
  ]
}
```

### 2.2 配置 TTS 参数

- **接口路径**: `/api/v1/admin/tts-configs`
- **请求方式**: `POST`
- **描述**: 添加或更新 TTS 模型的默认参数（如默认语速、采样率）。
- **权限要求**: 超级管理员

**请求参数 (DTO):**

| **字段名**         | **类型** | **必填** | **说明** |
| ------------------ | -------- | -------- | -------- |
| `modelName`        | String   | 是       | 模型名称 |
| `voiceType`        | String   | 是       | 声音类型 |
| `sampleRate`       | String   | 否       | 采样率   |
| `speedWordsPerMin` | Integer  | 否       | 默认语速 |
| `configJson`       | JSON     | 否       | 高级参数 |

**响应结构 (VO):** `Boolean`

------

## 3. 全局系统参数配置 (Global System Configs)

*对应《三级清单》中的“配置中心”与“运行配置” *

### 3.1 获取系统参数集合

- **接口路径**: `/api/v1/admin/configs/{category}`
- **请求方式**: `GET`
- **描述**: 按分类获取配置详情。
  - `category` 枚举: `SYSTEM` (基础), `STORAGE` (存储), `TRANSCODING` (转码), `SCHEDULING` (调度)。
- **权限要求**: 超级管理员

**响应结构 (VO) - 示例 (Category=SCHEDULING):**



```JSON
{
  "category": "SCHEDULING",
  "config": {
    "maxConcurrentGeneration": 3,   // 最大并发生成数 [cite: 917]
    "maxConcurrentTranscoding": 5,  // 最大并发转码数 [cite: 916]
    "taskQueueLimit": 50,           // 队列限制 [cite: 918]
    "retryPolicy": {                // 重试策略 [cite: 921]
      "maxAttempts": 3,
      "delaySeconds": 5
    }
  }
}
```

### 3.2 更新存储配置

- **接口路径**: `/api/v1/admin/configs/storage`

- **请求方式**: `PUT`

- **描述**: 修改文件存储策略。对应 `storage_configs` 表 。
- **权限要求**: 超级管理员

  

  

**请求参数 (DTO):**

| **字段名**    | **类型** | **必填** | **说明**            |
| ------------- | -------- | -------- | ------------------- |
| `storageType` | String   | 是       | VIDEO/MATERIAL/LOG  |
| `basePath`    | String   | 是       | 基础路径            |
| `maxCapacity` | Long     | 否       | 最大容量限制 (字节) |
| `fileTypes`   | JSON     | 否       | 允许的文件后缀      |

**响应结构 (VO):** `Boolean`

### 3.3 更新转码配置

- **接口路径**: `/api/v1/admin/configs/transcoding`

- **请求方式**: `PUT`

- **描述**: 修改默认的视频导出参数。对应 `transcoding_configs` 表 。
- **权限要求**: 超级管理员

  

  

**请求参数 (DTO):**

| **字段名**      | **类型** | **必填** | **说明**            |
| --------------- | -------- | -------- | ------------------- |
| `videoCodec`    | String   | 是       | H.264 / H.265       |
| `qualityPreset` | String   | 是       | HIGH / MEDIUM / LOW |
| `frameRate`     | Integer  | 否       | 帧率                |

**响应结构 (VO):** `Boolean`

### 3.4 更新任务调度配置

- **接口路径**: `/api/v1/admin/configs/scheduling`

- **请求方式**: `PUT`

- **描述**: 动态调整并发数，防止服务器过载。对应 `task_scheduling_configs` 表 。
- **权限要求**: 超级管理员

  

  

**请求参数 (DTO):**

| **字段名**                | **类型** | **必填** | **说明**    |
| ------------------------- | -------- | -------- | ----------- |
| `maxConcurrentGeneration` | Integer  | 是       | 生成并发数  |
| `taskQueueLimit`          | Integer  | 是       | 队列长度    |
| `cpuThresholdPercent`     | Integer  | 否       | CPU保护阈值 |

**响应结构 (VO):** `Boolean`





------

# 模块六：数据中心与统计分析模块 (Data & Statistics)

设计说明：

提供全平台的运营看板数据（用户/任务/财务）以及创作者个人的数据分析（作品/收益）。

注意：统计接口通常查询 _statistics 结尾的聚合表，而非直接扫描全量业务表，以保证性能。

------

## 1. 运营驾驶舱服务 (Admin Dashboard Service)



### 1.1 获取核心指标卡片 (Dashboard Cards)

- **接口路径**: `/api/v1/admin/stats/overview`
- **请求方式**: `GET`
- **描述**: 获取昨日/今日的核心运营指标，用于后台首页顶部的数字卡片展示。
- **权限要求**: 管理员

**响应结构 (VO):**

```JSON
{
  "statDate": "2026-01-13",
  "users": {
    "total": 10240,
    "newToday": 128,          // 对应 daily_statistics.new_users
    "activeToday": 512,       // 对应 daily_statistics.active_users
    "growthRate": 0.12        // 环比增长率 (后端计算)
  },
  "tasks": {
    "totalGenerated": 5000,   // 对应 daily_statistics.total_video_generated
    "successRate": 98.5,      // 对应 daily_statistics.task_success_rate
    "peakConcurrent": 15      // 对应 daily_statistics.peak_concurrent_tasks
  },
  "storage": {
    "totalUsedBytes": 1099511627776, // 1TB
    "storageRevenue": 500.00         // 存储营收
  }
}
```

### 1.2 获取趋势图表数据 (Trend Charts)

- **接口路径**: `/api/v1/admin/stats/trend`
- **请求方式**: `GET`
- **描述**: 获取指定时间范围内的折线图数据（用户增长、任务量趋势）。
- **权限要求**: 管理员

**请求参数 (Query):**

| **字段名**  | **类型** | **必填** | **说明** | **默认值**                           |
| ----------- | -------- | -------- | -------- | ------------------------------------ |
| `startDate` | Date     | 是       | 开始日期 | yyyy-MM-dd                           |
| `endDate`   | Date     | 是       | 结束日期 | yyyy-MM-dd                           |
| `metric`    | String   | 是       | 指标类型 | NEW_USERS, ACTIVE_USERS, TASK_VOLUME |

**响应结构 (VO):**

```JSON
{
  "xAxis": ["2026-01-01", "2026-01-02", "2026-01-03"], // 日期轴
  "series": [
    {
      "name": "新增用户",
      "data": [100, 120, 115]
    }
  ]
}
```

------

## 2. 任务与性能分析服务 (Task Analysis Service)





### 2.1 任务类型分布统计

- **接口路径**: `/api/v1/admin/stats/tasks/distribution`
- **请求方式**: `GET`
- **描述**: 获取不同任务类型（文生图、图生视频等）的占比饼图数据。
- **权限要求**: 管理员

**响应结构 (VO):**

```JSON
{
  "list": [
    { "type": "TEXT_TO_IMAGE", "count": 3000, "ratio": 0.6 },
    { "type": "IMAGE_TO_VIDEO", "count": 2000, "ratio": 0.4 }
  ]
}
```

### 2.2 任务失败原因分析

- **接口路径**: `/api/v1/admin/stats/tasks/failure-analysis`
- **请求方式**: `GET`
- **描述**: 统计 top N 的失败原因（基于日志或错误码），辅助运维排查。
- **权限要求**: 管理员

**响应结构 (VO):**



```JSON
{
  "list": [
    { "reason": "TIMEOUT", "count": 50, "description": "生成超时" },
    { "reason": "INSUFFICIENT_BALANCE", "count": 30, "description": "余额不足" }
  ]
}
```

------

## 3. 财务营收统计 (Financial Statistics)

### 3.1 获取财务报表

- **接口路径**: `/api/v1/admin/stats/finance`
- **请求方式**: `GET`
- **描述**: 按周期（日/周/月）查询营收、支出及付费用户数。
- **权限要求**: 管理员

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明**               |
| ---------- | -------- | -------- | ---------------------- |
| `period`   | String   | 是       | daily, weekly, monthly |
| `date`     | Date     | 是       | 统计日期               |

**响应结构 (VO):**

```JSON
{
  "totalRevenue": 10000.00,       // 总营收
  "totalExpense": 2000.00,        // 模型API调用成本 + 存储成本
  "netIncome": 8000.00,           // 净收入
  "composition": {
    "taskRevenue": 8000.00,       // 任务消耗营收
    "storageRevenue": 2000.00     // 存储扩容营收
  },
  "premiumUserCount": 50          // 付费会员数
}
```

------

## 4. 创作者个人数据服务 (Creator Personal Stats)

### 4.1 获取个人核心数据

- **接口路径**: `/api/v1/stats/creator/me`

- **请求方式**: `GET`

- **描述**: 获取模版创作者个人的粉丝数、模版销量、总收益等。
  - 注：核心关注模版的使用数据。
- **权限要求**: 登录用户

    

**响应结构 (VO):**

```JSON
{
  "followerCount": 1024,
  "totalTemplateSales": 5000,    // 模版销售/引用次数
  "templateRating": 4.8,         // 平均评分
  "totalRevenue": 1200.50,       // 模版收益
  "monthlyRevenue": 300.00
}
```

### 4.2 模版表现分析

- **接口路径**: `/api/v1/stats/creator/templates/analysis`
- **请求方式**: `GET`
- **描述**: 分析模版的趋势（销量、浏览量）。
- **权限要求**: 登录用户

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明**     |
| ---------- | -------- | -------- | ------------ |
| `days`     | Integer  | 否       | 最近7天/30天 |

**响应结构 (VO):**

```JSON
{
  "dates": ["01-01", "01-02", ...],
  "views": [100, 150, ...],
  "likes": [10, 20, ...]
}
```







------

# 模块七：模版市场与社区模块 (Template Marketplace & Community)

设计说明：

核心功能转变为 **模版市场**。普通用户在此浏览、购买、使用模版。同时保留对模版创作者的关注与评价功能。系统不再维护全站的“视频流”，但模版详情页可展示该模版的 Demo 视频。

**通用枚举定义:**

- `InteractionType`: `LIKE` (点赞模版), `FOLLOW` (关注创作者), `RATE` (评分)
- `NotificationType`: `SYSTEM` (系统), `LIKE` (获赞), `COMMENT` (评论), `FOLLOW` (新增粉丝)

------

## 1. 模版市场服务 (Marketplace Service)

### 1.1 获取模版列表 (首页推荐/搜索)

- **接口路径**: `/api/v1/market/templates`
- **请求方式**: `GET`
- **描述**: 获取市场上的模版列表。支持按热度、最新、价格筛选。
- **权限要求**: 匿名

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明**                   | **默认值** |
| ---------- | -------- | -------- | -------------------------- | ---------- |
| `page`     | Integer  | 否       | 页码                       | 1          |
| `sort`     | String   | 否       | HOT / NEW / PRICE_ASC      | HOT        |
| `keyword`  | String   | 否       | 搜索关键词                 | -          |
| `maxPrice` | Decimal  | 否       | 价格过滤                   | -          |

**响应结构 (VO):**

```json
{
  "total": 100,
  "list": [
    {
      "templateId": "TMP_009",
      "name": "赛博朋克风格Vlog",
      "coverUrl": "http://oss.../cover.jpg",
      "price": 0.00,
      "salesCount": 1200,
      "rating": 4.9,
      "author": {
        "userId": "U1001",
        "nickname": "模版大神",
        "avatar": "http://oss.../avatar.jpg"
      }
    }
  ]
}
```

### 1.2 获取模版详情

- **接口路径**: `/api/v1/market/templates/{templateId}`
- **请求方式**: `GET`
- **描述**: 获取模版详情（包含演示视频、参数说明、评论列表）。
- **权限要求**: 匿名

**响应结构 (VO):** 包含 `demoVideoUrl`, `workflowConfig` (仅简略信息), `isPurchased` 等字段。

### 1.3 购买/获取模版

- **接口路径**: `/api/v1/market/templates/{templateId}/purchase`
- **请求方式**: `POST`
- **描述**: 购买模版（若是免费则直接获取）。成功后将记录添加到 `user_assets`。
- **权限要求**: 登录用户

**响应结构 (VO):** `Boolean`



------

## 2. 互动服务 (Interaction Service)





### 2.1 点赞/取消点赞

- **接口路径**: `/api/v1/interactions/like`
- **请求方式**: `POST`
- **描述**: 对 **模版** 进行点赞/收藏。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名**   | **类型** | **必填** | **说明**                 | **校验规则** |
| ------------ | -------- | -------- | ------------------------ | ------------ |
| `targetId`   | String   | 是       | 模版ID                   | -            |
| `targetType` | String   | 是       | TEMPLATE                 | -            |
| `action`     | Boolean  | 是       | true(点赞) / false(取消) | -            |

**响应结构 (VO):** `Boolean`

### 2.2 关注/取关作者

- **接口路径**: `/api/v1/interactions/follow`
- **请求方式**: `POST`
- **描述**: 关注创作者。更新 `creators` 表的 `follower_count`。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明**                 |
| ---------- | -------- | -------- | ------------------------ |
| `authorId` | String   | 是       | 目标用户ID               |
| `action`   | Boolean  | 是       | true(关注) / false(取关) |

**响应结构 (VO):** `Boolean`

------

## 3. 评论服务 (Comment Service)



### 3.1 获取模版评价
- **接口路径**: `/api/v1/comments`
- **请求方式**: `GET`
- **描述**: 获取模版的评价/评论列表。
- **权限要求**: 匿名

**请求参数 (Query):**

| **字段名**     | **类型** | **必填** | **说明**                 |
| -------------- | -------- | -------- | ------------------------ |
| `templateId`   | String   | 是       | 模版ID                   |
| `sort`     | String   | 否       | HOT (热度) / TIME (时间) |
| `page`     | Integer  | 否       | 1                        |

**响应结构 (VO):**



```json
{
  "total": 50,
  "records": [
    {
      "commentId": "CMT001",
      "content": "生成的很逼真！",
      "author": { "userId": "U1002", "nickname": "路人甲", "avatar": "..." },
      "createTime": "2026-01-13 15:00:00",
      "likeCount": 10,
      "replyCount": 2,
      "isLiked": false
    }
  ]
}
```

### 3.2 发表/回复评论

- **接口路径**: `/api/v1/comments`
- **请求方式**: `POST`
- **描述**: 发表一级评论或回复二级评论。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名**      | **类型** | **必填** | **说明**   | **校验规则** |
| --------------- | -------- | -------- | ---------- | ------------ |
| `templateId`    | String   | 是       | 目标ID(模版ID) | -            |
| `content`       | String   | 是       | 评价内容       | 长度<500     |
| `parentId`      | String   | 否       | 父评论ID   | 回复时必填   |
| `replyToUserId` | String   | 否       | 被回复人ID | -            |

**响应结构 (VO):** `CommentVO` (返回新生成的评论数据)




## 5. 通知消息服务 (Notification Service)



### 5.1 获取消息列表

- **接口路径**: `/api/v1/notifications`
- **请求方式**: `GET`
- **描述**: 获取用户的通知消息。
- **权限要求**: 登录用户

**请求参数 (Query):**

| **字段名** | **类型** | **必填** | **说明**                |
| ---------- | -------- | -------- | ----------------------- |
| `type`     | String   | 否       | LIKE / COMMENT / SYSTEM |
| `page`     | Integer  | 否       | 1                       |

**响应结构 (VO):**

```
{
  "list": [
    {
      "msgId": 1001,
      "type": "LIKE",
      "title": "模版收到点赞",
      "content": "用户 路人甲 赞了你的模版",
      "relatedRedirectUrl": "/market/template/TMP009",
      "isRead": false,
      "createTime": "..."
    }
  ]
}
```

------

# 模块八：帮助与反馈模块 (Help & Feedback)

## 1. 反馈中心

### 1.1 提交意见反馈

- **接口路径**: `/api/v1/support/feedback`
- **请求方式**: `POST`
- **描述**: 用户提交产品建议或BUG反馈。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明**         | **校验规则** |
| ---------- | -------- | -------- | ---------------- | ------------ |
| `content`  | String   | 是       | 反馈内容         | 长度<1000    |
| `contact`  | String   | 否       | 联系方式         | -            |
| `images`   | Array    | 否       | 截图URL列表      | 最多9张      |

**响应结构 (VO):** `Boolean`

------

# 模块九：支付与订单中心 (Payment & Order Center)

设计说明：
统一处理全站的支付请求，对接第三方支付（微信/支付宝）。支持充值、购买会员、购买模版等多种业务场景。

**通用枚举定义:**
- `OrderType`: `RECHARGE` (充值), `VIP_SUBSCRIPTION` (会员订阅), `TEMPLATE_PURCHASE` (模版购买)
- `PayChannel`: `ALIPAY` (支付宝), `WECHAT` (微信), `BALANCE` (余额支付 - 仅限模版购买)
- `OrderStatus`: `PENDING` (待支付), `PAID` (已支付), `CANCELLED` (已取消), `REFUNDED` (已退款)

------

## 1. 订单与支付服务 (Order & Payment Service)

### 1.1 创建支付订单
- **接口路径**: `/api/v1/orders`
- **请求方式**: `POST`
- **描述**: 创建通用订单。根据 `orderType` 不同，`bizContent` 传递不同的业务参数。
- **权限要求**: 登录用户

**请求参数 (DTO):**

| **字段名** | **类型** | **必填** | **说明** | **校验规则** |
| :--- | :--- | :--- | :--- | :--- |
| `orderType` | String | 是 | 订单类型 | RECHARGE, VIP_SUBSCRIPTION, TEMPLATE_PURCHASE |
| `amount` | BigDecimal | 是 | 金额 | >0.01 |
| `payChannel` | String | 是 | 支付方式 | ALIPAY, WECHAT, BALANCE |
| `bizContent` | JSON | 是 | 业务参数 | 充值:{pkgId}, 会员:{planId}, 模版:{templateId} |

**响应结构 (VO):**

```JSON
{
  "orderId": "ORD20260114001",
  "payUrl": "https://qr.alipay.com/...", // 扫码支付链接或SDK参数
  "expireTime": "2026-01-14 10:15:00"
}
```

### 1.2 查询订单状态
- **接口路径**: `/api/v1/orders/{orderId}`
- **请求方式**: `GET`
- **描述**: 前端轮询订单支付状态。
- **权限要求**: 登录用户

**响应结构 (VO):**

```JSON
{
  "orderId": "ORD20260114001",
  "status": "PAID",
  "paidTime": "2026-01-14 10:05:00" // 仅PAID状态有值
}
```

### 1.3 支付回调通知 (Webhook)
- **接口路径**: `/api/v1/callbacks/payment/{channel}`
- **请求方式**: `POST`
- **描述**: 接收支付宝/微信的异步通知。
- **权限要求**: 匿名 (需验签)

**响应结构:** `String` (success/fail)

### 1.4 取消订单
- **接口路径**: `/api/v1/orders/{orderId}/cancel`
- **请求方式**: `POST`
- **描述**: 用户主动取消待支付订单。
- **权限要求**: 登录用户

**响应结构 (VO):** `Boolean`



