# 素材上传功能测试指南

## 📋 测试前准备

### 1. 确保后端服务已启动

**方式一：使用 IntelliJ IDEA**
- 打开 `backend` 文件夹
- 找到 `VideoPlatformApplication.java`
- 右键 → Run 'VideoPlatformApplication'
- 看到控制台输出 `Started VideoPlatformApplication` 表示启动成功

**方式二：使用命令行**
```bash
cd g:\ShiXi\xiangmu\video-creation-platform\backend
mvn spring-boot:run
```

**验证后端是否启动：**
- 访问：http://localhost:8080
- 或访问 API 文档：http://localhost:8080/doc.html (Knife4j)

### 2. 确保数据库和Redis运行

**MySQL：**
- 确保 MySQL 服务已启动
- 数据库名：`video_generation_platform`
- 确保存在以下表：
  - `image_materials`
  - `video_materials`
  - `audio_materials`
  - `users` (用于登录)

**Redis：**
- 确保 Redis 服务已启动（端口 6379）
- Windows 用户：运行 redis-server.exe

### 3. 确保文件上传目录存在

检查目录是否存在：
```
G:\ShiXi\xiangmu\upload\
```

如果不存在，创建该目录（后端会自动创建子目录，但需要确保父目录存在）

### 4. 确保前端已启动

- 前端地址：http://localhost:3000
- 如果未启动，执行：
```bash
cd g:\ShiXi\xiangmu\video-creation-platform\frontend
npm run dev
```

---

## 🧪 测试步骤

### 第一步：登录系统

1. 访问：http://localhost:3000
2. 如果没有账号，先注册：
   - 点击"注册"
   - 填写用户名、邮箱、密码
   - 注册成功后会自动登录

3. 如果已有账号，直接登录

**注意：** 素材上传功能需要登录后才能使用（需要 Token 认证）

### 第二步：进入素材管理页面

1. 登录后，导航到"素材管理"页面
2. 路径：`/material/list` 或通过菜单导航

### 第三步：测试上传功能

#### 测试 1：上传单个图片
1. 点击"上传素材"按钮
2. 选择一张图片文件（jpg/png/gif 等）
3. 点击"上传"按钮
4. **预期结果：**
   - 显示"成功上传 1 个文件"
   - 素材列表中出现新上传的图片
   - 文件保存在 `G:\ShiXi\xiangmu\upload\materials\image\日期\` 目录下

#### 测试 2：批量上传
1. 点击"上传素材"按钮
2. 选择多个文件（可以混合图片、视频、音频）
3. 点击"上传"按钮
4. **预期结果：**
   - 显示成功上传的文件数量
   - 所有文件都出现在素材列表中

#### 测试 3：上传视频
1. 选择视频文件（mp4/avi/mov 等）
2. 上传
3. **预期结果：**
   - 上传成功
   - 在"视频素材"标签页可以看到

#### 测试 4：上传音频
1. 选择音频文件（mp3/wav 等）
2. 上传
3. **预期结果：**
   - 上传成功
   - 在"音频素材"标签页可以看到

### 第四步：测试列表查询功能

#### 测试 1：按类型筛选
1. 点击"图片素材"标签
2. **预期结果：** 只显示图片类型的素材

#### 测试 2：关键词搜索
1. 在搜索框输入素材名称的关键词
2. 点击"搜索"按钮
3. **预期结果：** 显示匹配的素材

### 第五步：测试删除功能

1. 在素材列表中，点击某个素材的"删除"按钮
2. 确认删除
3. **预期结果：**
   - 显示"删除成功"
   - 素材从列表中消失
   - 物理文件也被删除

### 第六步：测试预览功能

1. 点击素材的"预览"按钮
2. **预期结果：**
   - 图片：在新窗口打开图片
   - 视频/音频：打开文件 URL

---

## 🔍 检查点

### 后端检查

1. **查看控制台日志：**
   - 上传时应该看到：`文件保存成功: ...`
   - 删除时应该看到：`文件删除成功: ...`

2. **检查数据库：**
   ```sql
   -- 查看图片素材
   SELECT * FROM image_materials WHERE is_deleted = 0;
   
   -- 查看视频素材
   SELECT * FROM video_materials WHERE is_deleted = 0;
   
   -- 查看音频素材
   SELECT * FROM audio_materials WHERE is_deleted = 0;
   ```

3. **检查文件系统：**
   - 文件应该保存在：`G:\ShiXi\xiangmu\upload\materials\{type}\{日期}\{文件名}`

### 前端检查

1. **打开浏览器开发者工具（F12）**
2. **查看 Network 标签：**
   - 上传请求：`POST /api/v1/material/upload`
   - 列表请求：`GET /api/v1/material/list`
   - 删除请求：`DELETE /api/v1/material/delete/{id}`

3. **查看 Console 标签：**
   - 检查是否有错误信息

---

## ⚠️ 常见问题排查

### 问题 1：上传失败，提示"文件不能为空"
- **原因：** 前端没有正确传递文件
- **解决：** 检查浏览器控制台的 Network 请求，确认 FormData 中是否有 file 字段

### 问题 2：上传失败，提示"文件大小不能超过500MB"
- **原因：** 文件超过限制
- **解决：** 选择较小的文件测试，或修改后端配置

### 问题 3：上传失败，提示"不支持的文件格式"
- **原因：** 文件扩展名不在支持列表中
- **解决：** 使用支持的文件格式（jpg, png, mp4, mp3 等）

### 问题 4：401 未授权错误
- **原因：** Token 过期或未登录
- **解决：** 重新登录获取新的 Token

### 问题 5：文件上传成功但列表不显示
- **原因：** 可能是数据库查询问题或前端数据映射问题
- **解决：** 
  1. 检查后端日志，确认数据已插入数据库
  2. 检查前端控制台，查看 API 返回的数据格式
  3. 刷新页面

### 问题 6：文件保存失败
- **原因：** 文件上传目录权限问题或路径不存在
- **解决：** 
  1. 检查 `G:\ShiXi\xiangmu\upload\` 目录是否存在
  2. 检查目录是否有写入权限
  3. 查看后端日志中的错误信息

### 问题 7：删除后文件还在
- **原因：** 文件删除逻辑可能有问题
- **解决：** 
  1. 检查后端日志，看是否有删除文件的日志
  2. 检查文件路径是否正确
  3. 手动删除文件测试

---

## 📝 测试检查清单

- [ ] 后端服务已启动（端口 8080）
- [ ] 前端服务已启动（端口 3000）
- [ ] MySQL 数据库已启动
- [ ] Redis 已启动
- [ ] 已登录系统
- [ ] 文件上传目录存在
- [ ] 测试上传单个图片 ✓
- [ ] 测试批量上传 ✓
- [ ] 测试上传视频 ✓
- [ ] 测试上传音频 ✓
- [ ] 测试按类型筛选 ✓
- [ ] 测试关键词搜索 ✓
- [ ] 测试删除功能 ✓
- [ ] 测试预览功能 ✓
- [ ] 检查数据库记录 ✓
- [ ] 检查文件系统 ✓

---

## 🎯 测试数据建议

准备以下测试文件：
- **图片：** 1-2 张不同格式的图片（jpg, png）
- **视频：** 1 个小视频文件（mp4，建议 < 10MB）
- **音频：** 1 个音频文件（mp3）

---

## 📞 如果遇到问题

1. **查看后端控制台日志** - 通常会有详细的错误信息
2. **查看浏览器控制台** - 检查前端错误和网络请求
3. **检查数据库** - 确认数据是否正确插入
4. **检查文件系统** - 确认文件是否正确保存

祝测试顺利！🚀
